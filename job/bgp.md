Creating routes in a BGP or MPLS VPN
	A CE device maintains the connection to the customer's network and is configured withing that network to share access to its available network prefixes and to receive packets from other VPN-connected networks. That CE is connected to a PE through an interface that is configured for a specified VRF for connection to the BGP or MPLS VPN. This connection places the CE in the BGP or MPLS VPN. Routes that are available through the CE are then made available to the PE using, OSPF, EBGP or a static route. These routes are then stored in the VRF where they are associated with the VPN. The route from the CE to the PE is kepts in the CEs routing table.
	The PE device is connected to the MPLS domain through one or more interfaces. The PE must advertise the routes that it has available in its VRF tables across the MPLS domain to its PE peers. Available routes in the VRF are prepeneded with a Route Distinguisher(RD) and advertised across the MPLS domain using IBGP and include the Route Target(RT) in it. The PEs can either be configured for IBGP as either full mesh or with a route reflector to allow greater scalability. Routes that are advertised from other PEs in the VPN are received at the PE and collected in the VRF table. This procedure establishes which other PEs are in the VPN and what networks are available through them.
	OSPF or ISIS is used in the Interior Gateway Protocol(IGP) within the service provider's MPLS domain to provide connectivity. OSPF or ISIS also populates the traffic engineering(TE) used by RSVP-TE.
	Label Switch Paths(LSPs) are then created using Label Distribution Protocol(LDP), Resouce Reservation Protocol(RSVP) configuration in the MPLS domain. Using this protocol, the PE obtains an LSP required to switch traffic to other PEs. The networks is now populate with all the routes required to forward packets between the customer's networks.

Routing a packet through a BGP or MPLS VPN.
	When a packet is forwarded from a CE to a PE, a bottom lable is attached to the packet by the PE that is associated with the final destination. This label is obtined from the egress PE as part of the route discovery conducted by IBGP. Then, the top lable which is obtained by the LSP connecting to the egress PE is added to the packet. The packet is then forwarded through the MPLS domain and is switched using the top label. At the penultimate device in the LSP, the top label is removed and the packet is forwarded to the egress PE. The egress PE uses the inner label to identify the CE to which the packet must be forwarded. The egress PE removes the inner label and forwards the packet to the correct CE.
